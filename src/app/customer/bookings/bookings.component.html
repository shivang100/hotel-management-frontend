<div class="max-w-7xl mx-auto p-6">
  <div class="flex items-center justify-between mb-6 gap-4 flex-wrap">
    <h1 class="text-3xl font-extrabold text-gray-900">My Bookings</h1>

    <div class="flex items-center gap-3">
      <div class="relative">
        <input
          [(ngModel)]="search"
          type="text"
          placeholder="Search room/type/id/status"
          class="w-64 pl-10 pr-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
        />
        <svg
          class="w-5 h-5 text-gray-400 absolute left-3 top-2.5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="m21 21-4.35-4.35m0 0A7.5 7.5 0 1 0 6.5 6.5a7.5 7.5 0 0 0 10.15 10.15Z"
          />
        </svg>
      </div>

      <select
        [(ngModel)]="sortBy"
        class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
      >
        <option value="newest">Newest first</option>
        <option value="oldest">Oldest first</option>
        <option value="checkin_asc">Check-in ↑</option>
        <option value="checkin_desc">Check-in ↓</option>
        <option value="room_asc">Room A–Z</option>
        <option value="room_desc">Room Z–A</option>
      </select>
    </div>
  </div>

  <!-- Tabs -->
  <div class="flex gap-2 mb-6 overflow-x-auto">
    <button
      *ngFor="let tab of tabs"
      (click)="activeTab = tab"
      class="px-4 py-2 rounded-full border text-sm transition"
      [ngClass]="
        activeTab === tab
          ? 'bg-green-800 text-white border-green-600'
          : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
      "
    >
      {{ tab.replace("_", " ") | titlecase }}
    </button>
  </div>

  <!-- States -->
  <div *ngIf="loading" class="text-gray-500">Loading your bookings…</div>
  <div *ngIf="!loading && error" class="text-red-600">{{ error }}</div>
  <div *ngIf="!loading && !error && view.length === 0" class="text-gray-600">
    No bookings found.
  </div>

  <!-- List -->
  <div
    *ngIf="!loading && !error && view.length"
    class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"
  >
    <div
      *ngFor="let b of view"
      class="bg-white border rounded-2xl shadow overflow-hidden"
    >
      <div class="h-40 bg-gray-100">
        <img
          [src]="b.room_main_image || 'assets/room-placeholder.jpg'"
          [alt]="b.room_name || 'Room ' + b.room_id"
          class="w-full h-full object-cover"
        />
      </div>

      <div class="p-5 space-y-3">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="text-lg font-bold text-gray-900 truncate">
              {{ b.room_name || "Room " + b.room_id }}
            </div>
            <div class="text-sm text-slate-600">{{ b.room_type || "—" }}</div>
          </div>

          <span
            class="px-2 py-1 rounded-full border text-xs"
            [ngClass]="badgeClass(b.status)"
          >
            {{ b.status || "—" | titlecase }}
          </span>
        </div>

        <div
          class="text-sm text-gray-700 grid grid-cols-1 sm:grid-cols-2 gap-x-6"
        >
          <div>
            <span class="text-gray-500">Mode:</span>
            <span class="ml-1 font-medium uppercase">{{ b.booking_mode }}</span>
          </div>

          <!-- Daily -->
          <ng-container *ngIf="b.booking_mode === 'daily'; else hourlyBlock">
            <div>
              <span class="text-gray-500">Check-in:</span>
              <span class="ml-1 font-medium">{{ checkInDisplay(b) }}</span>
            </div>
            <div>
              <span class="text-gray-500">Check-out:</span>
              <span class="ml-1 font-medium">{{ checkOutDisplay(b) }}</span>
            </div>
          </ng-container>

          <!-- Hourly -->
          <ng-template #hourlyBlock>
            <div>
              <span class="text-gray-500">Start:</span>
              <span class="ml-1 font-medium">{{ checkInDisplay(b) }}</span>
            </div>
            <div>
              <span class="text-gray-500">End:</span>
              <span class="ml-1 font-medium">{{ checkOutDisplay(b) }}</span>
            </div>
            <div>
              <span class="text-gray-500">Duration:</span>
              <span class="ml-1 font-medium"
                >{{ b.duration_hours || 1 }} h</span
              >
            </div>
          </ng-template>
        </div>

        <div class="pt-2 flex items-center justify-between gap-3">
          <button
            class="text-sm px-3 py-2 rounded-lg border bg-white hover:bg-gray-50"
            (click)="downloadPDF(b)"
          >
            Download PDF
          </button>

          <button
            class="text-sm px-3 py-2 rounded-lg border"
            [disabled]="!canRequestCancel(b)"
            [ngClass]="
              canRequestCancel(b)
                ? 'bg-rose-600 text-white border-rose-600 hover:bg-rose-700'
                : 'bg-gray-200 text-gray-500 border-gray-200 cursor-not-allowed'
            "
            (click)="requestCancel(b)"
          >
            Request Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
